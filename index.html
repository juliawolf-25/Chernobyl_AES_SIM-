<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ß–µ—Ä–Ω–æ–±—ã–ª—å—Å–∫–∞—è –ê–≠–° - –¢–æ—á–Ω–∞—è –º–æ–¥–µ–ª—å –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã 26 –∞–ø—Ä–µ–ª—è</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π 3D —Å–∏–º—É–ª—è—Ç–æ—Ä –≤–∑—Ä—ã–≤–∞ 4-–≥–æ —ç–Ω–µ—Ä–≥–æ–±–ª–æ–∫–∞ –ß–µ—Ä–Ω–æ–±—ã–ª—å—Å–∫–æ–π –ê–≠–°">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#000;color:#fff;overflow:hidden;touch-action:none}
        #loadingScreen{position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:10000}
        #loadingBar{width:300px;height:20px;background:#333;border-radius:10px;margin:20px 0;overflow:hidden}
        #loadingProgress{width:0;height:100%;background:#4CAF50;transition:width 0.3s}
        canvas{display:block;position:fixed;top:0;left:0}
        .panel{position:fixed;background:rgba(0,0,0,0.85);border-radius:12px;padding:15px;backdrop-filter:blur(10px);z-index:1000;border:1px solid rgba(255,255,255,0.1)}
        .info-panel{top:15px;left:15px;width:min(350px,90vw);max-height:90vh;overflow-y:auto}
        .controls-panel{top:15px;right:15px;display:flex;gap:8px;flex-wrap:wrap;max-width:400px}
        .reactor-panel{bottom:15px;left:15px;width:min(300px,90vw)}
        .reactor-controls{bottom:15px;right:15px;display:flex;gap:10px}
        button{background:linear-gradient(135deg,#2196F3,#21CBF3);border:none;color:white;padding:10px 15px;border-radius:8px;cursor:pointer;font-size:13px;font-weight:600;transition:all 0.2s;min-width:100px}
        button:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(33,150,243,0.4)}
        button.danger{background:linear-gradient(135deg,#f44336,#ff5252)}
        button.warning{background:linear-gradient(135deg,#FF9800,#FFC107)}
        button.success{background:linear-gradient(135deg,#4CAF50,#8BC34A)}
        .status{border-radius:8px;padding:12px;margin:10px 0;font-weight:bold;text-align:center}
        .normal{background:#4CAF50}
        .warning{background:#FF9800}
        .critical{background:#f44336}
        .catastrophe{background:#d32f2f}
        .parameter{display:flex;justify-content:space-between;margin:8px 0;align-items:center}
        .parameter label{color:#FF9800;font-weight:600;font-size:13px}
        .value{font-family:'Courier New',monospace;background:#222;padding:6px 10px;border-radius:6px;min-width:70px;text-align:center;font-size:12px}
        input[type="range"]{width:100%;margin:8px 0;height:6px}
        .hint{position:fixed;bottom:15px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.7);padding:8px 15px;border-radius:8px;font-size:12px;text-align:center}
        .quality-btn{position:fixed;top:15px;left:50%;transform:translateX(-50%);background:#333;color:#fff;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:11px;z-index:1000}
        @media (max-width:768px){
            .info-panel{top:5px;left:5px;right:5px;width:auto;max-height:120px;padding:10px;font-size:12px}
            .controls-panel{top:130px;left:5px;right:5px;justify-content:center}
            .reactor-panel{bottom:140px;left:5px;right:5px;width:auto}
            .reactor-controls{bottom:5px;left:5px;right:5px;flex-wrap:wrap;justify-content:center}
            button{min-width:80px;padding:8px 10px;font-size:11px}
            .hint{display:none}
        }
        @media (max-width:480px){
            .info-panel{max-height:100px;font-size:11px}
            .controls-panel{top:110px}
            button{min-width:70px;font-size:10px;padding:6px 8px}
        }
    </style>
</head>
<body>
    <div id="loadingScreen">
        <h2>üöÄ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏–º—É–ª—è—Ç–æ—Ä–∞ –ß–ê–≠–°</h2>
        <div id="loadingBar"><div id="loadingProgress"></div></div>
        <p id="loadingText">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è 3D –¥–≤–∏–∂–∫–∞...</p>
    </div>

    <div class="panel info-panel">
        <h3>‚ö° –ß–µ—Ä–Ω–æ–±—ã–ª—å—Å–∫–∞—è –ê–≠–° - –≠–Ω–µ—Ä–≥–æ–±–ª–æ–∫ 4</h3>
        <div style="font-size:12px;margin:5px 0;color:#aaa">26 –∞–ø—Ä–µ–ª—è 1986, 01:23:45</div>
        <div id="statusIndicator" class="status normal"><span id="statusText">–ù–û–†–ú–ê–õ–¨–ù–ê–Ø –†–ê–ë–û–¢–ê</span></div>
        <div id="timer" style="text-align:center;margin:10px 0;color:#FF9800">–í—Ä–µ–º—è –ø–æ—Å–ª–µ –≤–∑—Ä—ã–≤–∞: <span id="timeValue">0.0</span>—Å</div>
        <div id="phaseDescription" style="font-size:12px">–†–µ–∞–∫—Ç–æ—Ä –†–ë–ú–ö-1000 —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —à—Ç–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ.</div>
    </div>

    <div class="panel controls-panel">
        <button onclick="switchToStation()" id="btnStation" class="active">üè≠ –°—Ç–∞–Ω—Ü–∏—è</button>
        <button onclick="switchToCity()" id="btnCity">üèôÔ∏è –ì–æ—Ä–æ–¥</button>
        <button onclick="switchToSettlement()" id="btnSettlement">üèòÔ∏è –ü–æ—Å–µ–ª–µ–Ω–∏–µ</button>
        <button onclick="toggleDayNight()" id="btnDayNight">üåì –î–µ–Ω—å/–ù–æ—á—å</button>
        <button onclick="toggleQuality()" id="btnQuality">üìâ –ù–∏–∑–∫–æ–µ –∫–∞—á.</button>
    </div>

    <div class="panel reactor-panel">
        <h4 style="text-align:center;margin-bottom:10px;color:#FF9800">–ü–£–õ–¨–¢ –£–ü–†–ê–í–õ–ï–ù–ò–Ø –†–ï–ê–ö–¢–û–†–û–ú</h4>
        <div class="parameter">
            <label>–ú–æ—â–Ω–æ—Å—Ç—å (–ú–í—Ç):</label>
            <div class="value" id="powerValue">700</div>
        </div>
        <input type="range" min="0" max="1000" value="700" id="powerSlider" oninput="updatePower(this.value)">
        
        <div class="parameter">
            <label>–°—Ç–µ—Ä–∂–Ω–∏ (—à—Ç):</label>
            <div class="value" id="rodsValue">187</div>
        </div>
        <input type="range" min="0" max="211" value="187" id="rodsSlider" oninput="updateRods(this.value)">
        
        <div class="parameter">
            <label>–†–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (Œ≤):</label>
            <div class="value" id="reactivityValue">0.5</div>
        </div>
        <div id="reactivityWarning" style="font-size:11px;color:#FF9800;text-align:center;margin:5px 0">–ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
        
        <button onclick="activateAZ5()" class="danger" style="width:100%;margin-top:10px">‚õî –ê–ó-5 (–ê–í–ê–†–ò–ô–ù–ê–Ø –ó–ê–©–ò–¢–ê)</button>
        <div id="az5Warning" style="font-size:10px;text-align:center;margin:5px 0">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–µ–∞–∫—Ç–æ—Ä–∞</div>
    </div>

    <div class="panel reactor-controls">
        <button onclick="startExplosionSequence()" class="danger">üí• –ó–ê–ü–£–°–ö –í–ó–†–´–í–ê</button>
        <button onclick="spawnEmergencyVehicles()" class="warning">üöí –í–´–ó–í–ê–¢–¨ –¢–ï–•–ù–ò–ö–£</button>
        <button onclick="startRebuildSequence()" class="success">üèóÔ∏è –í–û–°–°–¢–ê–ù–û–í–ò–¢–¨</button>
        <button onclick="toggleSound()" class="warning">üîä –ó–≤—É–∫</button>
    </div>

    <div class="hint">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –õ–ö–ú + –¥–≤–∏–∂–µ–Ω–∏–µ = –≤—Ä–∞—â–µ–Ω–∏–µ, –ö–æ–ª–µ—Å–æ –º—ã—à–∏ = –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ</div>
    <button class="quality-btn" onclick="toggleQuality()" id="mobileQualityBtn">–ö–∞—á–µ—Å—Ç–≤–æ: –í—ã—Å–æ–∫–æ–µ</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ===
        const CONFIG = {
            isMobile: /iPhone|iPad|iPod|Android/i.test(navigator.userAgent),
            lowQuality: false,
            soundsEnabled: true,
            currentLocation: 'station',
            explosionStarted: false,
            explosionTime: 0
        };

        // === –°–û–°–¢–û–Ø–ù–ò–ï –†–ï–ê–ö–¢–û–†–ê ===
        const REACTOR = {
            power: 700,
            rods: 187,
            reactivity: 0.5,
            az5: false,
            exploded: false
        };

        // === –≠–õ–ï–ú–ï–ù–¢–´ DOM ===
        const DOM = {
            loadingScreen: document.getElementById('loadingScreen'),
            loadingProgress: document.getElementById('loadingProgress'),
            loadingText: document.getElementById('loadingText'),
            statusIndicator: document.getElementById('statusIndicator'),
            statusText: document.getElementById('statusText'),
            timer: document.getElementById('timer'),
            timeValue: document.getElementById('timeValue'),
            powerValue: document.getElementById('powerValue'),
            rodsValue: document.getElementById('rodsValue'),
            reactivityValue: document.getElementById('reactivityValue'),
            reactivityWarning: document.getElementById('reactivityWarning'),
            az5Warning: document.getElementById('az5Warning')
        };

        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
        function init() {
            updateLoading('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Three.js...', 20);
            
            try {
                // –°—Ü–µ–Ω–∞
                window.scene = new THREE.Scene();
                scene.background = new THREE.Color(0x87CEEB);
                
                // –ö–∞–º–µ—Ä–∞
                window.camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 5000);
                camera.position.set(0, 50, 150);
                
                // –†–µ–Ω–¥–µ—Ä–µ—Ä
                window.renderer = new THREE.WebGLRenderer({
                    antialias: !CONFIG.isMobile,
                    powerPreference: CONFIG.lowQuality ? "low-power" : "high-performance"
                });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(CONFIG.isMobile ? 1 : window.devicePixelRatio);
                renderer.shadowMap.enabled = !CONFIG.lowQuality;
                document.body.appendChild(renderer.domElement);
                
                updateLoading('–°–æ–∑–¥–∞–Ω–∏–µ –ª–∞–Ω–¥—à–∞—Ñ—Ç–∞...', 40);
                
                // –û—Å–≤–µ—â–µ–Ω–∏–µ
                setupLighting();
                
                // –ó–µ–º–ª—è
                createGround();
                
                updateLoading('–°–æ–∑–¥–∞–Ω–∏–µ –ê–≠–°...', 60);
                createChernobylPlant();
                
                updateLoading('–°–æ–∑–¥–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞...', 80);
                createCity();
                
                updateLoading('–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞...', 100);
                
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä–æ–π
                initCameraControls();
                
                // –ê–Ω–∏–º–∞—Ü–∏—è
                requestAnimationFrame(animate);
                
                // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏
                setTimeout(() => {
                    DOM.loadingScreen.style.opacity = '0';
                    setTimeout(() => DOM.loadingScreen.style.display = 'none', 300);
                }, 500);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                DOM.loadingText.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.';
            }
        }

        // === –ó–ê–ì–†–£–ó–ö–ê ===
        let loadProgress = 0;
        function updateLoading(text, progress) {
            DOM.loadingText.textContent = text;
            loadProgress = Math.max(loadProgress, progress);
            DOM.loadingProgress.style.width = loadProgress + '%';
        }

        // === –û–°–í–ï–©–ï–ù–ò–ï ===
        let sunLight, ambientLight, isDay = true;
        function setupLighting() {
            ambientLight = new THREE.AmbientLight(isDay ? 0xffffff : 0x444466, isDay ? 0.8 : 0.3);
            scene.add(ambientLight);
            
            sunLight = new THREE.DirectionalLight(isDay ? 0xffffff : 0x5566aa, isDay ? 1.2 : 0.4);
            sunLight.position.set(isDay ? 200 : -150, 300, isDay ? 200 : -150);
            sunLight.castShadow = !CONFIG.lowQuality;
            scene.add(sunLight);
            
            scene.background = new THREE.Color(isDay ? 0x87CEEB : 0x1a237e);
        }

        // === –õ–ê–ù–î–®–ê–§–¢ ===
        function createGround() {
            const ground = new THREE.Mesh(
                new THREE.PlaneGeometry(2000, 2000),
                new THREE.MeshPhongMaterial({ color: 0x8B7355 })
            );
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // –°—Ç–∞–Ω—Ü–∏—è
            const stationGround = new THREE.Mesh(
                new THREE.PlaneGeometry(400, 400),
                new THREE.MeshPhongMaterial({ color: 0x666666 })
            );
            stationGround.rotation.x = -Math.PI / 2;
            stationGround.position.set(0, 0.1, 0);
            scene.add(stationGround);
            
            // –ì–æ—Ä–æ–¥
            const cityGround = new THREE.Mesh(
                new THREE.PlaneGeometry(800, 800),
                new THREE.MeshPhongMaterial({ color: 0x5d8b5d })
            );
            cityGround.rotation.x = -Math.PI / 2;
            cityGround.position.set(200, 0.1, -300);
            scene.add(cityGround);
        }

        // === –ß–ê–≠–° ===
        function createChernobylPlant() {
            const plant = new THREE.Group();
            
            // –≠–Ω–µ—Ä–≥–æ–±–ª–æ–∫–∏
            for (let i = 0; i < 4; i++) {
                const unit = createUnit(i + 1);
                unit.position.set(-180 + i * 80, 0, 0);
                plant.add(unit);
            }
            
            // –ú–∞—à–∏–Ω–Ω—ã–π –∑–∞–ª
            const machineHall = new THREE.Mesh(
                new THREE.BoxGeometry(320, 24, 30),
                new THREE.MeshPhongMaterial({ color: 0x333333 })
            );
            machineHall.position.set(-120, 12, -40);
            plant.add(machineHall);
            
            scene.add(plant);
        }

        function createUnit(number) {
            const height = number === 4 ? 42 : 48;
            const color = number === 4 ? 0x666666 : 0x000000;
            
            const unit = new THREE.Mesh(
                new THREE.BoxGeometry(72, height, 72),
                new THREE.MeshPhongMaterial({ 
                    color: color,
                    transparent: number === 4,
                    opacity: number === 4 ? 0.4 : 1
                })
            );
            unit.position.y = height / 2;
            
            if (number <= 2) {
                const stripe1 = new THREE.Mesh(new THREE.BoxGeometry(72, 2, 2), 
                    new THREE.MeshPhongMaterial({ color: 0xffffff }));
                stripe1.position.set(0, 15, 36);
                unit.add(stripe1);
                
                const stripe2 = new THREE.Mesh(new THREE.BoxGeometry(72, 2, 2), 
                    new THREE.MeshPhongMaterial({ color: 0xffffff }));
                stripe2.position.set(0, 35, 36);
                unit.add(stripe2);
            }
            
            return unit;
        }

        // === –ì–û–†–û–î ===
        function createCity() {
            const city = new THREE.Group();
            city.position.set(200, 0, -300);
            
            // –ó–¥–∞–Ω–∏—è
            for (let i = 0; i < 20; i++) {
                const building = new THREE.Mesh(
                    new THREE.BoxGeometry(15 + Math.random() * 10, 20 + Math.random() * 30, 10 + Math.random() * 8),
                    new THREE.MeshPhongMaterial({ color: 0xffffff })
                );
                building.position.set(
                    -150 + Math.random() * 300,
                    building.geometry.parameters.height / 2,
                    -200 + Math.random() * 200
                );
                city.add(building);
            }
            
            scene.add(city);
        }

        // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ê–ú–ï–†–û–ô ===
        let cameraTarget = new THREE.Vector3(0, 20, 0);
        let cameraDistance = 150;
        let cameraPhi = Math.PI / 3;
        let cameraTheta = Math.PI / 4;
        let isMouseDown = false;
        let lastMouseX = 0, lastMouseY = 0;

        function initCameraControls() {
            const canvas = renderer.domElement;
            
            canvas.addEventListener('mousedown', (e) => {
                isMouseDown = true;
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
                canvas.style.cursor = 'grabbing';
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isMouseDown) return;
                
                const deltaX = e.clientX - lastMouseX;
                const deltaY = e.clientY - lastMouseY;
                
                cameraTheta -= deltaX * 0.005;
                cameraPhi -= deltaY * 0.005;
                cameraPhi = Math.max(0.1, Math.min(Math.PI - 0.1, cameraPhi));
                
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
                updateCamera();
            });
            
            document.addEventListener('mouseup', () => {
                isMouseDown = false;
                canvas.style.cursor = 'grab';
            });
            
            canvas.addEventListener('wheel', (e) => {
                cameraDistance += e.deltaY * 0.01;
                cameraDistance = Math.max(50, Math.min(500, cameraDistance));
                updateCamera();
            });
            
            // –°–µ–Ω—Å–æ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            canvas.addEventListener('touchstart', (e) => {
                if (e.touches.length === 1) {
                    isMouseDown = true;
                    lastMouseX = e.touches[0].clientX;
                    lastMouseY = e.touches[0].clientY;
                    e.preventDefault();
                }
            });
            
            canvas.addEventListener('touchmove', (e) => {
                if (!isMouseDown || e.touches.length !== 1) return;
                
                const deltaX = e.touches[0].clientX - lastMouseX;
                const deltaY = e.touches[0].clientY - lastMouseY;
                
                cameraTheta -= deltaX * 0.005;
                cameraPhi -= deltaY * 0.005;
                cameraPhi = Math.max(0.1, Math.min(Math.PI - 0.1, cameraPhi));
                
                lastMouseX = e.touches[0].clientX;
                lastMouseY = e.touches[0].clientY;
                updateCamera();
                e.preventDefault();
            });
            
            canvas.addEventListener('touchend', () => {
                isMouseDown = false;
            });
        }

        function updateCamera() {
            const x = cameraDistance * Math.sin(cameraPhi) * Math.cos(cameraTheta);
            const y = cameraDistance * Math.cos(cameraPhi);
            const z = cameraDistance * Math.sin(cameraPhi) * Math.sin(cameraTheta);
            
            camera.position.set(
                cameraTarget.x + x,
                cameraTarget.y + y,
                cameraTarget.z + z
            );
            camera.lookAt(cameraTarget);
        }

        // === –†–ï–ê–ö–¢–û–† ===
        function updatePower(value) {
            REACTOR.power = parseInt(value);
            DOM.powerValue.textContent = REACTOR.power;
            updateReactivity();
        }

        function updateRods(value) {
            REACTOR.rods = parseInt(value);
            DOM.rodsValue.textContent = REACTOR.rods;
            updateReactivity();
        }

        function updateReactivity() {
            const powerFactor = REACTOR.power / 1000;
            const rodsFactor = (211 - REACTOR.rods) / 211;
            REACTOR.reactivity = (powerFactor * rodsFactor * 4).toFixed(2);
            
            DOM.reactivityValue.textContent = REACTOR.reactivity;
            
            if (REACTOR.reactivity > 3.0) {
                DOM.reactivityWarning.textContent = "–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –†–ï–ê–ö–¢–ò–í–ù–û–°–¢–¨! –û–ü–ê–°–ù–û–°–¢–¨ –í–ó–†–´–í–ê!";
                DOM.reactivityWarning.style.color = "#f44336";
            } else if (REACTOR.reactivity > 1.5) {
                DOM.reactivityWarning.textContent = "–í–´–°–û–ö–ê–Ø –†–ï–ê–ö–¢–ò–í–ù–û–°–¢–¨! –ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã!";
                DOM.reactivityWarning.style.color = "#FF9800";
            } else {
                DOM.reactivityWarning.textContent = "–ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å";
                DOM.reactivityWarning.style.color = "#FF9800";
            }
        }

        function activateAZ5() {
            if (REACTOR.exploded) return;
            
            REACTOR.az5 = true;
            DOM.az5Warning.textContent = "–ê–ó-5 –ê–ö–¢–ò–í–ò–†–û–í–ê–ù–ê! –°—Ç–µ—Ä–∂–Ω–∏ –æ–ø—É—Å–∫–∞—é—Ç—Å—è...";
            DOM.az5Warning.style.color = "#f44336";
            
            if (REACTOR.reactivity >= 3.0) {
                setTimeout(() => {
                    DOM.az5Warning.textContent = "–í–ó–†–´–í –†–ï–ê–ö–¢–û–†–ê! –°—Ç–µ—Ä–∂–Ω–∏ –≤—ã–∑–≤–∞–ª–∏ —Å–∫–∞—á–æ–∫ –º–æ—â–Ω–æ—Å—Ç–∏!";
                    REACTOR.exploded = true;
                    startExplosionSequence();
                }, 2000);
            } else {
                setTimeout(() => {
                    DOM.az5Warning.textContent = "–†–µ–∞–∫—Ç–æ—Ä —É—Å–ø–µ—à–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω";
                    DOM.az5Warning.style.color = "#FF9800";
                    REACTOR.power = 0;
                    REACTOR.rods = 211;
                    updatePower(0);
                    updateRods(211);
                }, 3000);
            }
        }

        // === –í–ó–†–´–í ===
        let explosionEffects = [];
        function createExplosion() {
            const explosion = new THREE.Mesh(
                new THREE.SphereGeometry(5, 16, 16),
                new THREE.MeshBasicMaterial({ 
                    color: 0xff4500, 
                    transparent: true, 
                    opacity: 0.9 
                })
            );
            explosion.position.set(0, 25, 0);
            scene.add(explosion);
            explosionEffects.push(explosion);
            
            // –û–≥–æ–Ω—å
            for (let i = 0; i < 15; i++) {
                const fire = new THREE.Mesh(
                    new THREE.SphereGeometry(0.5 + Math.random(), 8, 8),
                    new THREE.MeshBasicMaterial({ 
                        color: new THREE.Color().setHSL(0.1, 1, 0.5), 
                        transparent: true, 
                        opacity: 0.8 
                    })
                );
                fire.position.set(
                    (Math.random() - 0.5) * 20,
                    20 + Math.random() * 10,
                    (Math.random() - 0.5) * 20
                );
                fire.userData = { speed: 0.03 };
                scene.add(fire);
                explosionEffects.push(fire);
            }
            
            updateStatus("üí• –í–ó–†–´–í –†–ï–ê–ö–¢–û–†–ê!", "catastrophe");
            playSound('explosion');
        }

        // === –ò–ù–¢–ï–†–§–ï–ô–° ===
        function startExplosionSequence() {
            if (CONFIG.explosionStarted) return;
            
            CONFIG.explosionStarted = true;
            createExplosion();
            
            setTimeout(() => {
                updateStatus("üö® –ê–í–ê–†–ò–ô–ù–ê–Ø –°–ò–¢–£–ê–¶–ò–Ø", "critical");
            }, 2000);
        }

        function spawnEmergencyVehicles() {
            updateStatus("üöí –ê–í–ê–†–ò–ô–ù–ê–Ø –¢–ï–•–ù–ò–ö–ê –í–´–ï–•–ê–õ–ê", "warning");
        }

        function startRebuildSequence() {
            CONFIG.explosionStarted = false;
            REACTOR.exploded = false;
            REACTOR.az5 = false;
            
            // –£–¥–∞–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –≤–∑—Ä—ã–≤–∞
            explosionEffects.forEach(obj => scene.remove(obj));
            explosionEffects = [];
            
            // –°–±—Ä–æ—Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            REACTOR.power = 700;
            REACTOR.rods = 187;
            REACTOR.reactivity = 0.5;
            
            DOM.powerValue.textContent = REACTOR.power;
            DOM.rodsValue.textContent = REACTOR.rods;
            DOM.reactivityValue.textContent = REACTOR.reactivity;
            DOM.powerSlider.value = REACTOR.power;
            DOM.rodsSlider.value = REACTOR.rods;
            DOM.reactivityWarning.textContent = "–ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å";
            DOM.reactivityWarning.style.color = "#FF9800";
            DOM.az5Warning.textContent = "–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–µ–∞–∫—Ç–æ—Ä–∞";
            DOM.az5Warning.style.color = "#FF9800";
            
            updateStatus("‚úÖ –°–¢–ê–ù–¶–ò–Ø –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ê", "normal");
        }

        function toggleDayNight() {
            isDay = !isDay;
            scene.remove(ambientLight);
            scene.remove(sunLight);
            setupLighting();
        }

        function switchToStation() {
            CONFIG.currentLocation = 'station';
            cameraTarget.set(0, 20, 0);
            cameraDistance = 150;
            updateButtons();
            updateCamera();
        }

        function switchToCity() {
            CONFIG.currentLocation = 'city';
            cameraTarget.set(200, 30, -300);
            cameraDistance = 250;
            updateButtons();
            updateCamera();
        }

        function switchToSettlement() {
            CONFIG.currentLocation = 'settlement';
            cameraTarget.set(600, 30, -300);
            cameraDistance = 200;
            updateButtons();
            updateCamera();
        }

        function updateButtons() {
            document.querySelectorAll('.controls-panel button').forEach(btn => btn.classList.remove('active'));
            const btn = document.getElementById('btn' + CONFIG.currentLocation.charAt(0).toUpperCase() + CONFIG.currentLocation.slice(1));
            if (btn) btn.classList.add('active');
        }

        function updateStatus(text, level) {
            DOM.statusText.textContent = text;
            DOM.statusIndicator.className = 'status ' + level;
        }

        function toggleQuality() {
            CONFIG.lowQuality = !CONFIG.lowQuality;
            renderer.setPixelRatio(CONFIG.lowQuality ? 1 : window.devicePixelRatio);
            renderer.shadowMap.enabled = !CONFIG.lowQuality;
            
            const btn = document.getElementById('btnQuality');
            const mobileBtn = document.getElementById('mobileQualityBtn');
            const text = CONFIG.lowQuality ? '–í—ã—Å–æ–∫–æ–µ' : '–ù–∏–∑–∫–æ–µ';
            if (btn) btn.textContent = CONFIG.lowQuality ? 'üìà –í—ã—Å–æ–∫–æ–µ –∫–∞—á.' : 'üìâ –ù–∏–∑–∫–æ–µ –∫–∞—á.';
            if (mobileBtn) mobileBtn.textContent = '–ö–∞—á–µ—Å—Ç–≤–æ: ' + text;
        }

        function toggleSound() {
            CONFIG.soundsEnabled = !CONFIG.soundsEnabled;
            const btn = document.querySelector('button[onclick="toggleSound()"]');
            if (btn) btn.textContent = CONFIG.soundsEnabled ? 'üîá –ó–≤—É–∫' : 'üîä –ó–≤—É–∫';
        }

        function playSound(type) {
            if (!CONFIG.soundsEnabled) return;
            
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∑–≤—É–∫–∏
            console.log('–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞:', type);
        }

        // === –ê–ù–ò–ú–ê–¶–ò–Ø ===
        let lastTime = 0;
        const fpsInterval = 1000 / (CONFIG.isMobile ? 30 : 60);

        function animate(currentTime) {
            requestAnimationFrame(animate);
            
            const deltaTime = currentTime - lastTime;
            if (deltaTime < fpsInterval) return;
            lastTime = currentTime - (deltaTime % fpsInterval);
            
            // –¢–∞–π–º–µ—Ä –≤–∑—Ä—ã–≤–∞
            if (CONFIG.explosionStarted) {
                CONFIG.explosionTime += deltaTime / 1000;
                DOM.timeValue.textContent = CONFIG.explosionTime.toFixed(1);
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –≤–∑—Ä—ã–≤–∞
                explosionEffects.forEach((obj, i) => {
                    if (i === 0) {
                        obj.scale.x += 0.05;
                        obj.scale.y += 0.05;
                        obj.scale.z += 0.05;
                        if (obj.scale.x > 3) obj.scale.set(1, 1, 1);
                    } else {
                        obj.position.y += obj.userData.speed;
                        if (obj.position.y > 50) {
                            obj.position.y = 20;
                        }
                    }
                });
            }
            
            renderer.render(scene, camera);
        }

        // === –°–ò–°–¢–ï–ú–ù–´–ï –§–£–ù–ö–¶–ò–ò ===
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∫–ª–∏–∫–µ (–¥–ª—è –∞—É–¥–∏–æ –≤ –±—Ä–∞—É–∑–µ—Ä–∞—Ö)
        document.addEventListener('click', () => {
            if (!window.initialized) {
                window.initialized = true;
                init();
            }
        }, { once: true });

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–ø—É—Å–∫–∞
        setTimeout(() => {
            if (!window.initialized) {
                DOM.loadingText.innerHTML = '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —ç–∫—Ä–∞–Ω –¥–ª—è –∑–∞–ø—É—Å–∫–∞<br><small style="color:#aaa">(—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞)</small>';
            }
        }, 1000);

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (–µ—Å–ª–∏ –∞—É–¥–∏–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
        if (!CONFIG.soundsEnabled) {
            window.initialized = true;
            init();
        }
    </script>
</body>
</html>